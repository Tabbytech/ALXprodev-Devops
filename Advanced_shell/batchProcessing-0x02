#!/bin/bash

# Directory to store data
output_dir="pokemon_data"
mkdir -p "$output_dir"

# List of Pokémon
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Loop through each Pokémon
for pokemon in "${pokemon_list[@]}"; do
    echo "Fetching data for $pokemon..."

    success=false
    attempts=0

    while [[ $success = false && $attempts -lt 3 ]]; do
        # Fetch data
        response=$(curl -s -w "%{http_code}" -o "$output_dir/$pokemon.json" "https://pokeapi.co/api/v2/pokemon/$pokemon")
        http_code="${response: -3}"  # Get the last 3 characters (HTTP status code)

        if [[ "$http_code" -eq 200 ]]; then
            echo "Saved data to $output_dir/$pokemon.json "
            success=true
        else
            echo "Failed to fetch $pokemon (status: $http_code), retrying..."
            ((attempts++))
            sleep 2
        fi
    done

    # Log if still unsuccessful
    if [[ $success = false ]]; then
        echo "Failed to fetch $pokemon after 3 attempts." >> fetch_errors.log
    fi
done
